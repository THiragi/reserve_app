<% provide(:title, @room.room_name) %>
<h2><%= @room.room_name %> -<%= @room.room_type.type_name %>- の予約状況</h2>
<div class="content">

<div class="icon">
<%= link_to "▲", @rooms, method: :get%>
</div>
<table class="calendar-table">
  <caption id="ymw" data-ymw-id="<%= @start %>"><%= @start.strftime('%Y年%m月') %></caption>
  <thead>
    <tr>
      <th style="color: #dc6b9a;">日</th>
      <th>月</th>
      <th>火</th>
      <th>水</th>
      <th>木</th>
      <th>金</th>
      <th style="color: #4496d3;">土</th>
    </tr>
  </thead>
  <tbody>

      <% (@start..@start.weeks_since(2)-1).each do |d| %>
      <% if d.wday == 0 %>
    <tr>
      <% end %>
      <%
        date_classes = []
        date_classes << "past" if d < @today
        date_classes << "sunday" if d.wday == 0
        date_classes << "saturday" if d.wday == 6
        date_classes << "current" if d == @today
      %>
      <td class="<%= date_classes.join(" ") %>">
        <%= d.day %><br>

        <%# その日が期間（start_date..end_date）に含まれている
            あるいは曜日（weekday）が当てはまっている@ratesを探す%>
        <% rates = @rates.where('start_date <= ? AND end_date >= ? OR weekday == ?', d, d, d.wday) %>
        <%# 結果がnilの場合は"-"を返す %>
        <% if rates == nil %>
          <p>-</p>
        <% else %>
        <%# 探した中で一番'rank:'の数字が小さい@ratesを探す %>
          <% r = rates.minimum('rank') %>
          <%# 結果がnilの場合は"-"を返す %>
            <% if r == nil %>
              <p>-</p>
            <% else %>
              
              <%= rates.find_by(rank: r).amount %>
            <% end %>
        <% end%>
      </td>
      <% if d.wday == 6 %>
    </tr>
      <% end %>
      <% end %>
  </tbody>
</table>

<div class="icon">
<%= link_to "▼", @rooms, method: :get%>
</div>

<% t = @today + 5 %>
<%= t %>


<div class="check_form">
  <label for="checkin">チェックイン日</label>
  <input type="date" id="checkin" value="2018-09-18" style="font-size: 15px;"/>
  <label for="checkout">チェックアウト日</label>
  <input type="date" id="checkout" value="2018-09-19" style="font-size: 15px;"/>
  <label for="guest_count">人数</label>
  <input type="tel" value="1" id="guest_count" maxlength="1" style="width: 40px; font-size: 15px;"/>
  <input type="submit" id="total" class="btn" value="料金を計算する"/>

  <div id="calc">
  <span style="font-size:20px;">泊数：</span>
  <span style="font-size:30px;">1泊</span>
  <span style="font-size:20px;">人数：</span>
  <span style="font-size:30px;">1名</span>
  <span style="font-size:20px;">宿泊料金：</span>
  <span style="font-size:40px;">5,000円</span>
  <div>
    <input type="submit" class="btn" value="他の部屋を探す"/>
    <input type="submit" class="btn" value="予約者情報を入力する"/>
  </div>
  </div>
</div>
